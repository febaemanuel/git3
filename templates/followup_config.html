{% extends "base.html" %}

{% block title %}Configurar Follow-up{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>üîÑ Configurar Follow-up Autom√°tico</h2>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <p class="text-muted">
                    O sistema pode enviar automaticamente mensagens de lembrete para pacientes que n√£o responderam.
                    Configure quantas tentativas e o intervalo entre elas.
                </p>

                <form method="POST">
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input type="checkbox" name="ativo" class="form-check-input" id="ativo"
                                   {% if config.ativo %}checked{% endif %}>
                            <label class="form-check-label" for="ativo">
                                <strong>Ativar Follow-up Autom√°tico</strong>
                            </label>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">N√∫mero M√°ximo de Tentativas</label>
                        <input type="number" name="max_tentativas" class="form-control"
                               value="{{ config.max_tentativas }}" min="1" max="10" required>
                        <small class="text-muted">Quantas vezes tentar contato al√©m do envio inicial</small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Intervalo entre Tentativas (dias)</label>
                        <input type="number" name="intervalo_dias" class="form-control"
                               value="{{ config.intervalo_dias }}" min="1" max="30" required>
                        <small class="text-muted">Aguardar quantos dias antes de enviar nova tentativa</small>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-save"></i> Salvar Configura√ß√£o
                    </button>

                    <form method="POST" action="{{ url_for('processar_followup_manual') }}" style="display:inline;">
                        <button type="submit" class="btn btn-outline-info">
                            <i class="bi bi-play"></i> Processar Follow-up Agora (Teste)
                        </button>
                    </form>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card bg-light">
            <div class="card-body">
                <h6 class="card-title">‚ÑπÔ∏è Como Funciona</h6>
                <ol>
                    <li>O sistema identifica pacientes que receberam mensagem mas n√£o responderam</li>
                    <li>Aguarda o intervalo configurado</li>
                    <li>Envia uma nova tentativa de contato</li>
                    <li>Repete at√© atingir o m√°ximo de tentativas</li>
                    <li>Marca como "sem resposta" se esgotar as tentativas</li>
                </ol>
                <hr>
                <h6>‚öôÔ∏è Automa√ß√£o</h6>
                <p class="small text-muted">
                    Para executar automaticamente, configure um cron job no servidor:
                </p>
                <code class="small">0 9 * * * python -c "from app import processar_followup_bg; processar_followup_bg()"</code>
            </div>
        </div>
    </div>
</div>
{% endblock %}
